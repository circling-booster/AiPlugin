<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plugin Remote Controller</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #ffffff;
            --accent-color: #00d2ff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ: ë°˜ì‘í˜• í•µì‹¬ */
        .container {
            width: 90%;
            max-width: 500px;
            /* ë°ìŠ¤í¬í†±ì—ì„œëŠ” ë„ˆë¬´ ë„“ì§€ ì•Šê²Œ */
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 1.5rem;
        }

        /* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ë§ */
        .control-group {
            margin: 40px 0;
        }

        .value-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
            display: block;
        }

        input[type=range] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #444;
            outline: none;
            cursor: pointer;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 210, 255, 0.5);
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ë§ */
        .btn {
            background: var(--accent-color);
            color: #000;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            /* ëª¨ë°”ì¼ ê¸°ë³¸: ê½‰ ì±„ìš°ê¸° */
            max-width: 200px;
            /* ë°ìŠ¤í¬í†±: ì ë‹¹í•œ í¬ê¸° */
        }

        .btn:active {
            transform: scale(0.95);
        }

        /* ìƒíƒœ ë©”ì‹œì§€ */
        #status {
            margin-top: 20px;
            font-size: 0.8rem;
            color: #666;
            min-height: 1.2em;
        }

        /* [ë¯¸ë””ì–´ ì¿¼ë¦¬] í™”ë©´ì´ ë„“ì€ ê²½ìš° (ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿) ì¶”ê°€ ì¡°ì • */
        @media (min-width: 768px) {
            .container {
                padding: 50px;
            }

            h1 {
                font-size: 2rem;
            }

            .btn {
                width: auto;
            }

            /* ë²„íŠ¼ í¬ê¸° ìë™ */
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸµ Pitch Control</h1>

        <div class="control-group">
            <span id="pitchValue" class="value-display">1.0</span>
            <input type="range" id="pitchSlider" min="0.5" max="2.0" step="0.1" value="1.0">
            <p style="color: #888; margin-top: 10px;">Speed & Pitch</p>
        </div>

        <button class="btn" onclick="sendReset()">Reset Default</button>

        <div id="status">Connecting...</div>
    </div>

    <script>
        const statusDiv = document.getElementById("status");

        // 1. URL ê²½ë¡œì—ì„œ Session ID ì¶”ì¶œ
        // URL íŒ¨í„´: http://host:port/remote/{session_id}
        const pathParts = window.location.pathname.split('/');
        // ë§ˆì§€ë§‰ ë¶€ë¶„ì´ session_idë¼ê³  ê°€ì • (ë¹ˆ ë¬¸ìì—´ ì œê±° í›„ ì²˜ë¦¬)
        const cleanPathParts = pathParts.filter(part => part.length > 0);
        const sessionId = cleanPathParts[cleanPathParts.length - 1];

        if (!sessionId) {
            statusDiv.innerText = "âŒ Error: Session ID missing in URL";
            statusDiv.style.color = "#f44336";
        }

        // 2. WebSocket ì—°ê²° ì£¼ì†Œ ìƒì„±
        // í”„ë¡œí† ì½œ ìë™ ê°ì§€ (https -> wss, http -> ws)
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}/ws/client/${sessionId}`;

        let ws;

        function connect() {
            if (!sessionId) return;

            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                statusDiv.innerText = "ğŸŸ¢ Connected to Host";
                statusDiv.style.color = "#4caf50";
            };

            ws.onclose = () => {
                statusDiv.innerText = "ğŸ”´ Disconnected (Retrying...)";
                statusDiv.style.color = "#f44336";
                setTimeout(connect, 3000); // 3ì´ˆ í›„ ìë™ ì¬ì—°ê²°
            };

            ws.onerror = (err) => {
                console.error("WS Error", err);
                ws.close();
            };
        }

        connect();

        const slider = document.getElementById("pitchSlider");
        const valDisplay = document.getElementById("pitchValue");

        // ìŠ¬ë¼ì´ë” ì¡°ì‘ ì‹œ ì´ë²¤íŠ¸
        slider.oninput = function () {
            valDisplay.innerText = this.value;
            if (ws && ws.readyState === WebSocket.OPEN) {
                const payload = {
                    type: "command",
                    plugin_id: "autoplay_tester",
                    action: "set_pitch",
                    value: parseFloat(this.value)
                };
                ws.send(JSON.stringify(payload));
            }
        }

        function sendReset() {
            slider.value = 1.0;
            slider.oninput(); // ê°’ ë³€ê²½ íŠ¸ë¦¬ê±° (ì „ì†¡ í¬í•¨)
        }
    </script>
</body>

</html>